<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุงุณุชูุทุงุจ ุงูููุงูุจ - ูุดุฑูุฉ AI</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <style>
        :root {
            --primary-color: #667eea; /* Bootstrap primary-like */
            --secondary-color: #764ba2; /* Bootstrap secondary-like */
            --accent-color: #f093fb;
            --success-color: #10b981; /* Bootstrap success-like */
            --warning-color: #f59e0b; /* Bootstrap warning-like */
            --error-color: #ef4444;   /* Bootstrap danger-like */
            --info-color: #0dcaf0;    /* Bootstrap info-like */
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            color: var(--text-primary);
            background-color: #f0f2f5; /* Lighter, more neutral background */
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container-fluid {
            padding-left: 30px;
            padding-right: 30px;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 50px 20px;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-lg);
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: -1px;
            color: white; /* Ensure text is white on gradient */
        }

        .header .subtitle {
            font-size: 1.25rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
        }

        .header .company-logo {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .section-card {
            background: var(--bg-primary);
            margin-bottom: 30px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .section-title {
            color: var(--text-primary);
            font-size: 1.75rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
        }

        .section-icon { /* Re-using for consistency if needed, or use i tags directly */
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.4rem;
        }
        
        .intro-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 10px;
            border-right: 5px solid var(--primary-color);
            position: relative;
        }
        .intro-text::before {
            content: 'โ'; /* Using a more standard quote */
            position: absolute;
            top: -5px;
            right: 20px;
            font-size: 3.5rem;
            color: var(--primary-color);
            opacity: 0.2;
        }

        .upload-area {
            border: 3px dashed var(--primary-color);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .upload-area:hover {
            background: #e9ecef; /* Light hover for Bootstrap feel */
            border-color: var(--secondary-color);
        }
        .upload-area.dragover {
            background: #dde2e6;
            border-color: var(--primary-color);
            transform: scale(1.02);
        }
        .upload-icon {
            font-size: 3.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            animation: bounce 2s infinite; /* Keeping bounce animation */
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .btn { /* General btn enhancements if needed, Bootstrap handles most */
            padding: 10px 25px;
            font-weight: 600;
            font-size: 1rem;
            border-radius: 8px;
            margin: 5px; /* Bootstrap's margin utilities can also be used */
        }
        .btn-primary {
             background-color: var(--primary-color);
             border-color: var(--primary-color);
        }
        .btn-primary:hover {
             background-color: darken(var(--primary-color), 10%);
             border-color: darken(var(--primary-color), 10%);
        }
        /* Custom gradients for specific buttons if desired */
        .btn-gradient-success {
            background: linear-gradient(45deg, var(--success-color), #059669);
            color: white;
        }
        .btn-gradient-warning {
            background: linear-gradient(45deg, var(--warning-color), #d97706);
            color: white;
        }
         .btn-gradient-danger {
            background: linear-gradient(45deg, var(--error-color), #dc2626);
            color: white;
        }


        .input-field { /* Will be replaced by form-control mostly */
            border-radius: 8px;
        }

        .output-box { /* For general output, can be styled like a card-body */
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
            white-space: pre-wrap;
            font-size: 1rem;
            line-height: 1.7;
        }
        
        /* New result display card */
        .analysis-result-card {
            margin-top: 20px;
            border-left: 5px solid var(--success-color);
        }
        .analysis-result-card .card-title {
            color: var(--success-color);
        }
        .analysis-result-card .list-group-item {
            background-color: var(--bg-secondary);
            border-color: var(--border-color);
        }

        .candidate-card-bs { /* Bootstrap candidate card */
            border-radius: 15px;
            padding: 25px;
        }
        .candidate-avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        .compatibility-score {
            display: inline-block;
            padding: 10px 18px;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            margin-top: 15px;
            font-size: 1rem;
        }
        .score-high { background: linear-gradient(45deg, var(--success-color), #059669); }
        .score-medium { background: linear-gradient(45deg, var(--warning-color), #d97706); }
        .score-low { background: linear-gradient(45deg, var(--error-color), #dc2626); }

        .questions-list .list-group-item {
            background: white;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-right: 4px solid var(--primary-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }
        .questions-list .list-group-item:hover {
            transform: translateX(-5px);
            box-shadow: var(--shadow-md);
        }

        .chat-container {
            height: 350px;
            overflow-y: auto;
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        .chat-message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 12px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .user-message {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            margin-right: auto;
            border-bottom-right-radius: 5px;
        }
        .ai-message {
            background: white;
            border: 1px solid var(--border-color);
            margin-left: auto;
            border-bottom-left-radius: 5px;
            box-shadow: var(--shadow-sm);
        }

        .value-points .card {
            border-right: 5px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        .value-points .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .value-points .card h3 {
            color: var(--text-primary);
            font-size: 1.2rem;
        }

        .loading { display: none; text-align: center; color: var(--primary-color); font-style: italic; font-size: 1rem; padding: 15px; }
        .loading.show { display: block; }
        .loading-spinner { display: inline-block; width: 25px; height: 25px; border: 3px solid rgba(102, 126, 234, 0.3); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s ease-in-out infinite; margin-left: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .progress-bar-custom { /* Custom name to avoid conflict with Bootstrap's .progress-bar */
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill-custom {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .sidebar {
            background-color: var(--bg-primary);
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow-md);
        }
        .sidebar h4 {
            color: var(--primary-color);
        }
        .sidebar ul li {
            padding: 8px 0;
            color: var(--text-secondary);
        }
        .sidebar ul li i {
            margin-left: 8px; /* For RTL, this should be margin-right if icons are before text */
        }

        /* Floating shapes - kept from original */
        .floating-shapes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .shape { position: absolute; opacity: 0.07; animation: float 10s ease-in-out infinite; } /* Slower animation, less opacity */
        .shape:nth-child(1) { top: 15%; left: 5%; animation-delay: 0s; width: 100px; height: 100px; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); border-radius: 50%;}
        .shape:nth-child(2) { top: 55%; right: 8%; animation-delay: 3s; width: 80px; height: 80px; background: linear-gradient(45deg, var(--secondary-color), var(--accent-color)); border-radius: 20px;}
        .shape:nth-child(3) { bottom: 10%; left: 15%; animation-delay: 6s; width: 120px; height: 120px; background: linear-gradient(45deg, var(--accent-color), var(--primary-color)); clip-path: polygon(50% 0%, 0% 100%, 100% 100%);}
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
            50% { transform: translateY(-25px) rotate(45deg) scale(1.05); }
        }

        /* Ensure FontAwesome icons are vertically aligned with text */
        .fas, .far, .fal, .fab {
            vertical-align: middle;
        }
        .section-title .fas {
            margin-left: 10px; /* Adjust for RTL if icon is after title */
        }
        
        /* Alert styling */
        .alert {
            padding: 1rem; /* Bootstrap default, can adjust */
        }
        .alert-success-custom {
            background-color: #d1e7dd; /* Bootstrap success background */
            color: #0f5132; /* Bootstrap success text */
            border-color: #badbcc; /* Bootstrap success border */
        }
        .alert-danger-custom {
            background-color: #f8d7da; /* Bootstrap danger background */
            color: #842029; /* Bootstrap danger text */
            border-color: #f5c2c7; /* Bootstrap danger border */
        }
        
        /* Voice controls adjustments */
        .voice-controls .btn {
            margin: 5px;
        }
        .voice-status {
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid transparent;
        }
        .status-listening {
            background: linear-gradient(45deg, #dcfce7, #bbf7d0);
            color: var(--success-color);
            border-color: var(--success-color);
        }
        .status-stopped {
            background: linear-gradient(45deg, #fef3c7, #fde68a);
            color: var(--warning-color);
            border-color: var(--warning-color);
        }
         .audio-wave {
            display: none;
            width: 50px; /* Slightly smaller */
            height: 35px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 40"><rect x="5" y="15" width="4" height="10" fill="%23667eea"><animate attributeName="height" values="10;25;10" dur="0.8s" repeatCount="indefinite"/></rect><rect x="15" y="10" width="4" height="20" fill="%23667eea"><animate attributeName="height" values="20;35;20" dur="0.8s" repeatCount="indefinite" begin="0.2s"/></rect><rect x="25" y="12" width="4" height="16" fill="%23667eea"><animate attributeName="height" values="16;30;16" dur="0.8s" repeatCount="indefinite" begin="0.4s"/></rect><rect x="35" y="8" width="4" height="24" fill="%23667eea"><animate attributeName="height" values="24;32;24" dur="0.8s" repeatCount="indefinite" begin="0.6s"/></rect><rect x="45" y="14" width="4" height="12" fill="%23667eea"><animate attributeName="height" values="12;22;12" dur="0.8s" repeatCount="indefinite" begin="0.8s"/></rect></svg>') no-repeat center;
            background-size: contain;
        }
        .audio-wave.show {
            display: inline-block;
        }


    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-brain me-2"></i>ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุงุณุชูุทุงุจ ุงูููุงูุจ</h1>
            <p class="subtitle">ุญููู ูุชูุฏูุฉ ููุชูุธูู ุงูุฐูู ูู ุงูุฌูุงุช ุงูุญููููุฉ</p>
            <div class="company-logo">
                <i class="fas fa-building me-1"></i> ูุดุฑูุฉ AI
            </div>
        </div>

        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-3 order-lg-last mb-4 mb-lg-0">
                <div class="sidebar sticky-top" style="top: 20px;">
                    <h4 class="mb-3"><i class="fas fa-star me-2"></i> ููุงุฆุฏ ุงููุธุงู ุงูุฃุณุงุณูุฉ</h4>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="fas fa-tachometer-alt text-success fa-fw me-2"></i> ูููุฑ ูุง ูุตู ุฅูู <strong>67%</strong> ูู ููุช ุงูููุธู ุงูุฅุฏุงุฑู.</li>
                        <li class="mb-2"><i class="fas fa-users-cog text-info fa-fw me-2"></i> ุชุนุฒูุฒ ุฏูุฉ ุงุฎุชูุงุฑ ุงููุฑุดุญูู ุจูุณุจุฉ ุนุงููุฉ.</li>
                        <li class="mb-2"><i class="fas fa-chart-line text-warning fa-fw me-2"></i> ุชุญุณูู ุชุฌุฑุจุฉ ุงูุชูุฏูู ูููุฑุดุญูู ูุงูููุธููู.</li>
                        <li class="mb-2"><i class="fas fa-dollar-sign text-danger fa-fw me-2"></i> ุชูููู ุชูุงููู ุงูุชูุธูู ุจุดูู ููุญูุธ.</li>
                        <li class="mb-2"><i class="fas fa-balance-scale text-primary fa-fw me-2"></i> ุถูุงู ุงูููุถูุนูุฉ ูุงูุญูุงุฏ ูู ุงูุชูููู.</li>
                         <li class="mb-2"><i class="fas fa-microphone-alt text-secondary fa-fw me-2"></i> ููุงุจูุงุช ุตูุชูุฉ ุฐููุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ.</li>
                    </ul>
                    <hr>
                    <p class="text-muted small">ูุธุงู ูุดุฑูุฉ AI: ูุญู ูุณุชูุจู ุชูุธูู ุฃูุซุฑ ุฐูุงุกู ูููุงุกุฉ.</p>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9 order-lg-first">
                <!-- ุงููุณู ุงูุฃูู: ุชุนุฑูู ุงููุธุงู -->
                <div class="section-card card">
                    <div class="card-body">
                        <h2 class="section-title">
                            <span class="section-icon"><i class="fas fa-info-circle"></i></span>
                            ุชุนุฑูู ุงููุธุงู
                        </h2>
                        <div class="intro-text">
                            ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูุฎุงุต ุจูุง ูู ุญู ุชููู ูุชูุฏู ูุตูู ูุชุญููู ุนูููุงุช ุงุณุชูุทุงุจ ุงูููุงูุจ ูู ุงูุฌูุงุช ุงูุญููููุฉ ุฅูู ุนูููุงุช ุฐููุฉุ ูุคุชูุชุฉุ ูุณุฑูุนุฉ. ูุนุชูุฏ ุงููุธุงู ุนูู ูุฏุฑุงุช ูุชูุฏูุฉ ูู ุชุญููู ุงูุจูุงูุงุชุ ุงูุชูุจุคุ ูุชูููุฏ ุงููุญุชููุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅุฌุฑุงุก ููุงุจูุงุช ูุจุฏุฆูุฉ ุจูุธุงู ุตูุชู ุฐูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ููุณุงุนุฏุฉ ูุฑู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ ุนูู ุงุชุฎุงุฐ ูุฑุงุฑุงุช ุฏูููุฉ ุจููุงุกุฉ ุฃุนูู ูููุถูุนูุฉ ุชุงูุฉ.
                        </div>
                    </div>
                </div>

                <!-- ุงููุณู ุงูุซุงูู: ุงุณุชูุจุงู ุงูุณูุฑ ุงูุฐุงุชูุฉ -->
                <div class="section-card card">
                    <div class="card-body">
                        <h2 class="section-title">
                            <span class="section-icon"><i class="fas fa-file-upload"></i></span>
                            ุงุณุชูุจุงู ูุชุญููู ุงูุณูุฑ ุงูุฐุงุชูุฉ
                        </h2>
                        <div class="upload-area mb-3" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <p style="font-size: 1.1rem; margin-bottom: 10px;">ุงุณุญุจ ูุฃููุช ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ููุง ุฃู ุงููุฑ ููุงุฎุชูุงุฑ</p>
                            <p class="text-muted small">ูุฏุนู ูููุงุช PDF ู Word (ุญุชู 10 ููุฌุงุจุงูุช)</p>
                            <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" class="d-none">
                        </div>
                        <button class="btn btn-primary" onclick="document.getElementById('resumeFile').click()">
                            <i class="fas fa-folder-open me-2"></i> ุงุฎุชูุงุฑ ููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ
                        </button>
                        
                        <div class="file-info mt-3 p-3 border rounded bg-light" id="fileInfo" style="display: none;">
                            <h5 class="mb-2"><i class="fas fa-file-alt me-2 text-primary"></i> ูุนูููุงุช ุงูููู:</h5>
                            <div class="row">
                                <div class="col-md-4"><small><strong>ุงุณู ุงูููู:</strong> <span id="fileName">-</span></small></div>
                                <div class="col-md-4"><small><strong>ุญุฌู ุงูููู:</strong> <span id="fileSize">-</span></small></div>
                                <div class="col-md-4"><small><strong>ููุน ุงูููู:</strong> <span id="fileType">-</span></small></div>
                            </div>
                        </div>

                        <div class="alert alert-danger-custom mt-3" id="errorMessage" style="display: none;"></div>
                        <div class="alert alert-success-custom mt-3" id="successMessage" style="display: none;"></div>

                        <button class="btn btn-gradient-success mt-3" id="analyzeResumeBtn" onclick="analyzeResume()" disabled>
                            <i class="fas fa-brain me-2"></i> ุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
                        </button>
                        
                        <div class="loading mt-3" id="resumeLoading">
                            <i class="fas fa-cog fa-spin me-1"></i> ุฌุงุฑู ุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ...
                            <div class="loading-spinner"></div>
                        </div>
                        
                        <div class="progress-bar-custom mt-3" id="progressBar" style="display: none;">
                            <div class="progress-fill-custom" id="progressFill"></div>
                        </div>
                        
                        <!-- Enhanced Result Display -->
                        <div class="card analysis-result-card mt-3" id="analysisResultCard" style="display: none;">
                            <div class="card-body">
                                <h5 class="card-title mb-3"><i class="fas fa-check-circle me-2"></i> ุชู ุชุญููู ุงูููู ุจูุฌุงุญ!</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><strong><i class="fas fa-file-signature me-2 text-primary"></i> ุงุณู ุงูููู:</strong> <span id="resultFileNameDisplay">-</span></li>
                                    <li class="list-group-item"><strong><i class="fas fa-info-circle me-2 text-info"></i> ูุนูููุงุช ูุณุชุฎุฑุฌุฉ:</strong> <span id="resultInfoCountDisplay">-</span> ููุงุท ุฑุฆูุณูุฉ.</li>
                                    <li class="list-group-item"><strong><i class="fas fa-star me-2 text-warning"></i> ุชูููู ุฃููู:</strong> <span id="resultClassificationDisplay">-</span></li>
                                </ul>
                                <button class="btn btn-outline-primary btn-sm mt-3" data-bs-toggle="collapse" href="#fullAnalysisDetails" role="button" aria-expanded="false" aria-controls="fullAnalysisDetails">
                                    ุนุฑุถ ุงูุชุญููู ุงููุงูู <i class="fas fa-chevron-down ms-1"></i>
                                </button>
                                <div class="collapse mt-2" id="fullAnalysisDetails">
                                    <div class="output-box" id="resumeOutput"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ุงููุณู ุงูุซุงูุซ: ุชูููู ุงููุฑุดุญูู -->
                <div class="section-card card">
                    <div class="card-body">
                        <h2 class="section-title">
                            <span class="section-icon"><i class="fas fa-user-check"></i></span>
                            ุชูููู ุงููุฑุดุญูู
                        </h2>
                        <div class="card candidate-card-bs" id="candidateCard" style="display: none;">
                             <div class="d-flex align-items-center mb-3">
                                <div class="candidate-avatar me-3">
                                    <i class="fas fa-user"></i>
                                </div>
                                <h3 id="candidateName" class="mb-0" style="color: var(--text-primary);">ุงุณู ุงููุฑุดุญ</h3>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><p><i class="fas fa-birthday-cake me-2 text-primary"></i><strong>ุงูุนูุฑ:</strong> <span id="candidateAge">-</span></p></div>
                                <div class="col-md-6"><p><i class="fas fa-graduation-cap me-2 text-primary"></i><strong>ุงููุคูู:</strong> <span id="candidateQualification">-</span></p></div>
                                <div class="col-md-6"><p><i class="fas fa-briefcase me-2 text-primary"></i><strong>ุงูุฎุจุฑุฉ:</strong> <span id="candidateExperience">-</span></p></div>
                                <div class="col-md-6"><p><i class="fas fa-map-marker-alt me-2 text-primary"></i><strong>ุงููููุน:</strong> <span id="candidateLocation">-</span></p></div>
                            </div>
                            <button class="btn btn-gradient-warning" onclick="evaluateCandidate()">
                                <i class="fas fa-chart-line me-2"></i> ุชุญููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงููุชูุฏู
                            </button>
                            <div class="loading mt-3" id="evaluationLoading">
                                <i class="fas fa-brain fa-spin me-1"></i> ุฌุงุฑู ุชูููู ุงููุฑุดุญ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู...
                                <div class="loading-spinner"></div>
                            </div>
                            <div id="evaluationResult" class="mt-3"></div>
                        </div>
                    </div>
                </div>

                <!-- ุงููุณู ุงูุฑุงุจุน: ุชูููุฏ ุฃุณุฆูุฉ ุงูููุงุจูุงุช -->
                <div class="section-card card">
                    <div class="card-body">
                        <h2 class="section-title">
                           <span class="section-icon"><i class="fas fa-question-circle"></i></span>
                            ุชูููุฏ ุฃุณุฆูุฉ ุงูููุงุจูุงุช ุงููุฎุตุตุฉ
                        </h2>
                        <textarea class="form-control input-field mb-3" id="jobDescription" placeholder="ุฃุฏุฎู ูุตู ุงููุธููุฉ ุฃู ุงููุชุทูุจุงุช ุงููุญุฏุฏุฉ ููููุตุจ..." rows="5"></textarea>
                        <button class="btn btn-primary" onclick="generateQuestions()">
                            <i class="fas fa-magic me-2"></i> ุชูููุฏ ุงูุฃุณุฆูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
                        </button>
                        <div class="loading mt-3" id="questionsLoading">
                            <i class="fas fa-lightbulb fa-spin me-1"></i> ุฌุงุฑู ุชูููุฏ ุฃุณุฆูุฉ ูุฎุตุตุฉ...
                            <div class="loading-spinner"></div>
                        </div>
                        <div class="questions-list list-group mt-3" id="questionsList"></div>
                    </div>
                </div>

                <!-- ุงููุณู ุงูุฎุงูุณ: ุงูููุงุจูุงุช ุงูุตูุชูุฉ -->
                <div class="section-card card">
                     <div class="card-body">
                        <h2 class="section-title">
                            <span class="section-icon"><i class="fas fa-microphone"></i></span>
                            ุงูููุงุจูุงุช ุงูุตูุชูุฉ ุงููุจุฏุฆูุฉ
                        </h2>
                        <p class="mb-3 text-muted">
                            <i class="fas fa-info-circle me-1 text-primary"></i> ูููู ูููุชูุฏู ุฅุฌุฑุงุก ููุงุจูุฉ ูุจุฏุฆูุฉ ุชูุงุนููุฉ ุจุงูุตูุช ุจุงููุบุฉ ุงูุนุฑุจูุฉ ูุน ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู.
                        </p>
                        
                        <div class="voice-controls d-flex flex-wrap align-items-center mb-3">
                            <button class="btn btn-success me-2 mb-2" id="startInterviewBtn" onclick="startVoiceInterview()">
                                <i class="fas fa-play me-1"></i> ุจุฏุก ุงูููุงุจูุฉ
                            </button>
                            <button class="btn btn-danger me-2 mb-2" id="stopInterviewBtn" onclick="stopVoiceInterview()" disabled>
                                <i class="fas fa-stop me-1"></i> ุฅููุงู ุงูููุงุจูุฉ
                            </button>
                            <div class="voice-status me-2 mb-2" id="voiceStatus">
                                <i class="fas fa-microphone-slash me-1"></i> ุบูุฑ ูุดุท
                            </div>
                            <div class="audio-wave mb-2" id="audioWave"></div>
                        </div>
                        
                        <div class="chat-container" id="voiceChat">
                            <div class="ai-message">
                                <i class="fas fa-robot me-1"></i> ูุฑุญุจุงู ุจู ูู ุงูููุงุจูุฉ ุงููุจุฏุฆูุฉ ุงูุฐููุฉ. ุณุฃุทุฑุญ ุนููู ุจุนุถ ุงูุฃุณุฆูุฉ ุงูุนุงูุฉ ูุชูููู ูุคููุงุชู. ุชุญุฏุซ ุจูุถูุญ ูุณุฃููู ุจุงูุงุณุชูุงุน ุฅููู ูุชุญููู ุฅุฌุงุจุงุชู.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ุงููุณู ุงูุณุงุฏุณ: ุงููุณุงุนุฏ ุงูุฐูู ุงูุชูุงุนูู -->
                <div class="section-card card">
                    <div class="card-body">
                        <h2 class="section-title">
                            <span class="section-icon"><i class="fas fa-robot"></i></span>
                            ุงููุณุงุนุฏ ุงูุฐูู ุงูุชูุงุนูู
                        </h2>
                        <div class="chat-container" id="chatContainer">
                            <div class="ai-message">
                                <i class="fas fa-robot me-1"></i> ูุฑุญุจุงู! ุฃูุง ุงููุณุงุนุฏ ุงูุฐูู ุงููุชุฎุตุต ูู ุฃูุธูุฉ ุงูุชูุธูู ูุงูููุงุฑุฏ ุงูุจุดุฑูุฉ. ููู ูููููู ูุณุงุนุฏุชู ุงููููุ
                            </div>
                        </div>
                        <div class="d-flex gap-2 mt-3">
                            <input type="text" class="form-control input-field" id="chatInput" placeholder="ุงูุชุจ ุงุณุชูุณุงุฑู ููุง...">
                            <button class="btn btn-primary" onclick="sendChatMessage()">
                                <i class="fas fa-paper-plane me-1"></i> ุฅุฑุณุงู
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ุงููุณู ุงูุณุงุจุน: ุชูุฎูุต ุงููุฑุดุญ ูุงูุชูุตูุฉ ุงูููุงุฆูุฉ -->
                <div class="section-card card">
                    <div class="card-body">
                        <h2 class="section-title">
                            <span class="section-icon"><i class="fas fa-clipboard-check"></i></span>
                            ุชูุฎูุต ุงููุฑุดุญ ูุงูุชูุตูุฉ ุงูููุงุฆูุฉ
                        </h2>
                        <button class="btn btn-gradient-warning" onclick="generateRecommendation()">
                            <i class="fas fa-file-contract me-2"></i> ุชูููุฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ
                        </button>
                        <div class="loading mt-3" id="recommendationLoading">
                            <i class="fas fa-chart-pie fa-spin me-1"></i> ุฌุงุฑู ุฅุนุฏุงุฏ ุงูุชูุฑูุฑ ุงูููุงุฆู...
                            <div class="loading-spinner"></div>
                        </div>
                        <div class="output-box mt-3" id="recommendationOutput"></div>
                    </div>
                </div>

                <!-- ุงููุณู ุงูุซุงูู: ุงููููุฉ ุงููุถุงูุฉ ูููุธุงู -->
                <div class="section-card card">
                    <div class="card-body">
                        <h2 class="section-title">
                            <span class="section-icon"><i class="fas fa-gem"></i></span>
                            ุงููููุฉ ุงููุถุงูุฉ ูููุธุงู
                        </h2>
                        <div class="row g-4 value-points">
                            <div class="col-md-6 col-lg-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-rocket fa-2x text-primary mb-2"></i>
                                        <h3 class="h5">ุชุณุฑูุน ุนูููุฉ ุงูุชูุธูู</h3>
                                        <p class="small text-muted">ุชูููู ููุช ุงููุฑุงุฌุนุฉ ูู ุฃุณุงุจูุน ุฅูู ุณุงุนุงุช ูุน ุฏูุฉ ุนุงููุฉ.</p>
                                    </div>
                                </div>
                            </div>
                             <div class="col-md-6 col-lg-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-coins fa-2x text-success mb-2"></i>
                                        <h3 class="h5">ุชูููู ุงูุชูุงููู</h3>
                                        <p class="small text-muted">ุชูููุฑ ูุจูุฑ ูู ุชูุงููู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ ูุงูููุช ูุงูุฌูุฏ.</p>
                                    </div>
                                </div>
                            </div>
                             <div class="col-md-6 col-lg-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-balance-scale fa-2x text-warning mb-2"></i>
                                        <h3 class="h5">ุชูุตูุงุช ูุญุงูุฏุฉ</h3>
                                        <p class="small text-muted">ูุฑุงุฑุงุช ููุถูุนูุฉ ุจูุงุกู ุนูู ุงูุจูุงูุงุช ูุงูุชุญููู ุงูุนููู.</p>
                                    </div>
                                </div>
                            </div>
                             <div class="col-md-6 col-lg-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-bar fa-2x text-info mb-2"></i>
                                        <h3 class="h5">ุชูุงุฑูุฑ ุฐููุฉ</h3>
                                        <p class="small text-muted">ุชูุงุฑูุฑ ุชูุตูููุฉ ูุชุญููููุฉ ุฌุงูุฒุฉ ูุตุงุญุจ ุงููุฑุงุฑ.</p>
                                    </div>
                                </div>
                            </div>
                             <div class="col-md-6 col-lg-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-smile fa-2x text-secondary mb-2"></i>
                                        <h3 class="h5">ุชุญุณูู ุงูุชุฌุฑุจุฉ</h3>
                                        <p class="small text-muted">ุชุฌุฑุจุฉ ูุญุณูุฉ ูููุชูุฏููู ูุงูููุธููู ุนูู ุญุฏ ุณูุงุก.</p>
                                    </div>
                                </div>
                            </div>
                             <div class="col-md-6 col-lg-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-microphone-alt fa-2x" style="color: var(--accent-color);" mb-2></i>
                                        <h3 class="h5">ููุงุจูุงุช ุตูุชูุฉ ุฐููุฉ</h3>
                                        <p class="small text-muted">ุชูููู ูุจุฏุฆู ุชูุงุนูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุงููุบุฉ ุงูุนุฑุจูุฉ.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- End Main Content Col -->
        </div> <!-- End Row -->
    </div> <!-- End Container Fluid -->

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // Gemini API Configuration
        const GEMINI_API_KEY = 'AIzaSyAO8Dw-QeBiGiPZZfCx_3ueTl0LiK9ZFj0'; // ุงุณุชุฎุฏู ููุชุงุญ API ุงูุฎุงุต ุจู ููุง
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent'; // ุชู ุงูุชุญุฏูุซ ุฅูู 1.5 flash

        // Global variables
        let currentCandidate = null;
        let recognition = null;
        let isInterviewActive = false;
        let interviewQuestions = [
            "ุญุฏุซูู ุนู ููุณู ูุฎุจุฑุงุชู ุงูููููุฉ ุจุดูู ูุฎุชุตุฑ.",
            "ูุง ูู ููุงุท ููุชู ุงูุฑุฆูุณูุฉ ุงูุชู ุชููุฒู ุนู ุงููุฑุดุญูู ุงูุขุฎุฑููุ",
            "ููุงุฐุง ุชุฑูุฏ ุงูุนูู ูู ุงููุทุงุน ุงูุญูููู ุชุญุฏูุฏุงูุ",
            "ููู ุชุชุนุงูู ูุน ุถุบุท ุงูุนูู ูุงูููุงุนูุฏ ุงูููุงุฆูุฉ ุงูุถููุฉุ",
            "ูุง ูู ุฃูุฏุงูู ุงูููููุฉ ููุณููุงุช ุงููุงุฏูุฉุ",
            "ุงุฐูุฑ ููููุงู ูุงุฌูุช ููู ุชุญุฏูุงู ูู ุงูุนูู ูููู ุชุนุงููุช ูุนู."
        ];
        let currentQuestionIndex = 0;

        const SYSTEM_PROMPTS = {
            resumeAnalysis: `ุฃูุช ูุญูู ุณูุฑ ุฐุงุชูุฉ ุฎุจูุฑ ูุชุฎุตุต ูู ุงูุชูุธูู ุงูุญูููู. ูู ุจุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุงููุฑููุฉ ุจุฏูุฉ ุนุงููุฉ ูุงุณุชุฎุฑุฌ ุงููุนูููุงุช ุงูุชุงููุฉ ุจุชูุณูู ููุธู ููููู:

            ๐ **ุงููุนูููุงุช ุงูุดุฎุตูุฉ:**
            - ุงูุงุณู ุงููุงูู: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูุนูุฑ (ุฅุฐุง ูุชููุฑ): [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูุฌูุณูุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ููุงู ุงูุฅูุงูุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ูุนูููุงุช ุงูุงุชุตุงู: [ุงุณุชุฎุฑุฌู ููุง]

            ๐ **ุงููุคููุงุช ุงูุชุนููููุฉ:**
            - ุงูุฏุฑุฌุงุช ุงูุนูููุฉ ูุน ุงูุชุฎุตุต: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูุฌุงูุนุงุช ูุงููุนุงูุฏ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุณููุงุช ุงูุชุฎุฑุฌ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงููุนุฏู ุงูุชุฑุงููู (ุฅุฐุง ูุชููุฑ): [ุงุณุชุฎุฑุฌู ููุง]

            ๐ผ **ุงูุฎุจุฑุฉ ุงูููููุฉ:**
            - ุฅุฌูุงูู ุณููุงุช ุงูุฎุจุฑุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูููุงุตุจ ุงูุณุงุจูุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุฃุณูุงุก ุงูุดุฑูุงุช/ุงููุคุณุณุงุช: [ุงุณุชุฎุฑุฌู ููุง]
            - ูุชุฑุงุช ุงูุนูู: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูุฅูุฌุงุฒุงุช ุงูุฑุฆูุณูุฉ: [ุงุณุชุฎุฑุฌู ููุง]

            ๐๏ธ **ุงูููุงุฑุงุช ูุงูููุงุกุงุช:**
            - ุงูููุงุฑุงุช ุงูุชูููุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูููุงุฑุงุช ุงูุดุฎุตูุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงููุบุงุช ููุณุชูู ุงูุฅุฌุงุฏุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูุดูุงุฏุงุช ุงูููููุฉ: [ุงุณุชุฎุฑุฌู ููุง]

            โญ **ููุงุท ุงูููุฉ:**
            - ุฃุจุฑุฒ ููุงุท ุงูููุฉ ุงููุณุชุฎุฑุฌุฉ ูู ุงูุณูุฑุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงููููุฒุงุช ุงูุชูุงูุณูุฉ: [ุงุณุชุฎุฑุฌู ููุง]
            - ุงูุฎุจุฑุงุช ุงููุชุฎุตุตุฉ: [ุงุณุชุฎุฑุฌู ููุง]

            ๐ **ููุฎุต ูููู ูุชูููู ุฃููู:**
            - ุชูููู ุนุงู ูููุฑุดุญ: [ุงูุชุจ ุชูููููุง ููุฌุฒูุง ููุง]
            - ูุฏู ููุงุกูุชู ููุนูู ุงูุญูููู: [ุงูุชุจ ุชูููููุง ููุฌุฒูุง ููุง]
            - ุงูุชูุตูุงุช ุงูุฃูููุฉ: [ุงูุชุจ ุชูุตูุฉ ุฃูููุฉ ููุฌุฒุฉ ููุงุ ูุซู "ูุฑุดุญ ูุงุนุฏ" ุฃู "ูุญุชุงุฌ ููุฒูุฏ ูู ุงูุฎุจุฑุฉ ูู X"]
            - ุนุฏุฏ ุงูููุงุท ุงูุฑุฆูุณูุฉ ุงููุณุชุฎุฑุฌุฉ: [ุงุฐูุฑ ุนุฏุฏูุง ุชูุฑูุจููุง ูููุนูููุงุช ุงููุงูุฉ ุงูุชู ุชู ุงุณุชุฎุฑุงุฌูุง]

            ุงูุชุจ ุงูุฑุฏ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุดูู ููุธู ููููู ูุน ุงุณุชุฎุฏุงู ุงูุฑููุฒ ุงูุชุนุจูุฑูุฉ ููุชูุณูู. ุชุฃูุฏ ูู ุฃู ุงููุนูููุงุช ูุงุจูุฉ ููุงุณุชุฎุฑุงุฌ ุจุณูููุฉ.`,
            
            candidateEvaluation: `ุฃูุช ุฎุจูุฑ ุชูููู ูุฑุดุญูู ูุชุฎุตุต ูู ุงูุชูุธูู ููุฌูุงุช ุงูุญููููุฉ. ุจูุงุกู ุนูู ุจูุงูุงุช ุงููุฑุดุญ ุงูููุฏูุฉุ ูู ุจุฅุฌุฑุงุก ุชูููู ุดุงูู ูููุตู:

            ๐ฏ **ุชูููู ุงูุชูุงูู ูุน ุงููุชุทูุจุงุช:**
            - ูุณุจุฉ ุงูุชูุงูู ุงูุฅุฌูุงููุฉ (ูู 100%): [ุถุน ูุณุจุฉ ููุง]
            - ุชูุตูู ุฏุฑุฌุงุช ุงูุชูููู ููู ูุนูุงุฑ: [ุงุดุฑุญ ููุง]
            - ูุจุฑุฑุงุช ุงููุณุจุฉ ุงููุนุทุงุฉ: [ูุถุญ ููุง]

            ๐ช **ุชุญููู ููุงุท ุงูููุฉ:**
            - ููุงุท ุงูููุฉ ุงูุฑุฆูุณูุฉ: [ุงุฐูุฑูุง ููุง]
            - ุงูููุงุฑุงุช ุงููููุฒุฉ: [ุงุฐูุฑูุง ููุง]
            - ุงูุฎุจุฑุงุช ุฐุงุช ุงููููุฉ ุงููุถุงูุฉ: [ุงุฐูุฑูุง ููุง]

            โ๏ธ **ููุงุท ุงูุชุญุณูู ุงููุทููุจุฉ:**
            - ุงููุฌุงูุงุช ุงูุชู ุชุญุชุงุฌ ุชุทููุฑ: [ุงุฐูุฑูุง ููุง]
            - ุงูุชุฏุฑูุจ ุงูููุชุฑุญ: [ุงุฐูุฑู ููุง]
            - ุงูุฎุจุฑุงุช ุงููุงูุตุฉ: [ุงุฐูุฑูุง ููุง]

            ๐๏ธ **ููุงุกูุฉ ุงูุนูู ุงูุญูููู:**
            - ูุฏู ุชูุงูู ุงูุฎูููุฉ ูุน ุงูุจูุฆุฉ ุงูุญููููุฉ: [ุงุดุฑุญ ููุง]
            - ุงููุฏุฑุฉ ุนูู ุงูุชููู ูุน ุงูููุงุฆุญ: [ุงุดุฑุญ ููุง]
            - ุงูุงูุชุฒุงู ุจุงูููู ุงูุญููููุฉ: [ุงุดุฑุญ ููุง]

            ๐ **ุชุนููู ูููู ุดุงูู:**
            - ุชูููู ุนุงู ูููุฑุดุญ: [ุงูุชุจ ุชููููู ููุง]
            - ุงูุชูุตูุฉ ุงูุฃูููุฉ: [ุงูุชุจ ุชูุตูุชู ููุง]
            - ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ: [ุงุฐูุฑูุง ููุง]

            ุงูุชุจ ุงูุฑุฏ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุดูู ูููู ูููุตู.`,
            
            questionGeneration: `ุฃูุช ุฎุจูุฑ ูู ุฅุนุฏุงุฏ ุฃุณุฆูุฉ ุงูููุงุจูุงุช ูููุธุงุฆู ุงูุญููููุฉ. ุจูุงุกู ุนูู ูุตู ุงููุธููุฉ ุงูููุฏูุ ูู ุจุชูููุฏ ูุฌููุนุฉ ุดุงููุฉ ูู ุงูุฃุณุฆูุฉ ุงูููููุฉ (ุฅุฌูุงูู 5-7 ุฃุณุฆูุฉ ูุชููุนุฉ):

            ๐ **ุฃุณุฆูุฉ ุงูุฎุจุฑุฉ ุงูููููุฉ (2-3 ุฃุณุฆูุฉ):**
            1. [ุณุคุงู ููุง]
            2. [ุณุคุงู ููุง]
            
            ๐ง **ุฃุณุฆูุฉ ุงูููุงุฑุงุช ุงูุชูููุฉ ูุงูุณููููุฉ (2 ุฃุณุฆูุฉ):**
            3. [ุณุคุงู ููุง]
            4. [ุณุคุงู ููุง]

            ๐๏ธ **ุฃุณุฆูุฉ ุงูููู ูุงูููุงูู (1-2 ุณุคุงู):**
            5. [ุณุคุงู ููุง]

            ูู ุจุตูุงุบุฉ ุงูุฃุณุฆูุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุดูู ูุงุถุญ ูููููุ ูุน ุชุฑููู ูู ุณุคุงู.`,
            
            chatAssistant: `ุฃูุช ูุณุงุนุฏ ุฐูู ูุชุฎุตุต ููุชูุฏู ูู ุฃูุธูุฉ ุงูุชูุธูู ูุงูููุงุฑุฏ ุงูุจุดุฑูุฉ ููุฌูุงุช ุงูุญููููุฉ. ุชุฎุตุตู ูุดูู:

            ๐๏ธ **ุงูุชูุธูู ุงูุญูููู:** ุนูููุงุช ุงูุชูุธููุ ุงูููุงุฆุญุ ูุนุงููุฑ ุงูุชูููู.
            ๐ค **ุฃูุธูุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู:** ุชุทุจููุงุช AI ูู HRุ ุฃุชูุชุฉ ุงูุนูููุงุชุ ุชุญููู ุงูุจูุงูุงุช.
            ๐ฅ **ุฅุฏุงุฑุฉ ุงูููุงูุจ:** ุงุณุชูุทุงุจุ ุชููููุ ุชุทููุฑ.
            ๐ **ุงูุชุญููู ูุงูุชูููู:** ูุคุดุฑุงุช ุฃุฏุงุกุ ุชูุงุฑูุฑุ ุงุชุฎุงุฐ ูุฑุงุฑุงุช.

            ูู ุจุงูุฑุฏ ุนูู ุงุณุชูุณุงุฑุงุช ุงููุณุชุฎุฏููู ุจุดูู ูููุฏ ููููู ูููุตู ุจุงููุบุฉ ุงูุนุฑุจูุฉ. ุงุณุชุฎุฏู ุชูุณูููุง ูุงุถุญูุง ูุฑููุฒูุง ุชุนุจูุฑูุฉ ุฅุฐุง ูุงู ุฐูู ููุงุณุจูุง.`,
            
            voiceInterview: `ุฃูุช ููุงุจู ุฐูู ูุชุฎุตุต ูู ุฅุฌุฑุงุก ุงูููุงุจูุงุช ุงููุจุฏุฆูุฉ ููุฌูุงุช ุงูุญููููุฉ. ุฏูุฑู ูู:

            ๐ฏ **ุฅุฌุฑุงุก ููุงุจูุฉ ููููุฉ:** ุทุฑุญ ุฃุณุฆูุฉ ููุงุณุจุฉุ ุชูููู ุงูุฅุฌุงุจุงุช ุจููุถูุนูุฉุ ุชูุฏูู ุชุนูููุงุช ุจูุงุกุฉ.
            ๐ **ูุนุงููุฑ ุงูุชูููู:** ูุถูุญ ุงูุชุนุจูุฑุ ููุงุกูุฉ ุงูุฅุฌุงุจุงุชุ ุงูุซูุฉุ ุงููุนุฑูุฉ.
            ๐ฌ **ุฃุณููุจ ุงูุชูุงุนู:** ูู ููููุงู ููุดุฌุนุงูุ ุงุณุชุฎุฏู ูุบุฉ ูุงุถุญุฉ.

            ุนูุฏ ุชูููู ุฅุฌุงุจุฉ ุงููุณุชุฎุฏูุ ูุฏู ุชุนููููุง ููุฌุฒูุง (ุฌููุฉ ุฃู ุงุซูุชูู) ูุฑูุฒ ุนูู ุชุดุฌูุน ุงููุณุชุฎุฏู ุฃู ุทูุจ ุชูุถูุญ ุฅุฐุง ูุฒู ุงูุฃูุฑ ูุจู ุงูุงูุชูุงู ููุณุคุงู ุงูุชุงูู. ุงูุชุจ ุจุงููุบุฉ ุงูุนุฑุจูุฉ.`,
            
            finalRecommendation: `ุฃูุช ุฎุจูุฑ ูู ุฅุนุฏุงุฏ ุงูุชูุตูุงุช ุงูููุงุฆูุฉ ูููุฑุดุญูู ูู ุงูุฌูุงุช ุงูุญููููุฉ. ูู ุจุฅุนุฏุงุฏ ุชูุฑูุฑ ุดุงูู ูููุตู:

            ๐ **ุงูููุฎุต ุงูุชูููุฐู:**
            - ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุฑุดุญุ ุฃุจุฑุฒ ุงูููุงุท ุงูุฅูุฌุงุจูุฉุ ุงูููุงุญุธุงุช ุงูุฑุฆูุณูุฉ.

            โญ **ููุงุท ุงูููุฉ:**
            - ุงููุคููุงุช ูุงูุฎุจุฑุงุช ุงููููุฒุฉุ ุงูููุงุฑุงุช ุงูุงุณุชุซูุงุฆูุฉุ ุงูุฅูุฌุงุฒุงุช ุงูุจุงุฑุฒุฉ.

            โ๏ธ **ููุงุท ุงูุถุนู ุฃู ุงูุชุญุณูู:**
            - ุงููุฌุงูุงุช ุงูุชู ุชุญุชุงุฌ ุชุทููุฑุ ุงูุฎุจุฑุงุช ุงููุงูุตุฉุ ุงูุชุฏุฑูุจ ุงููุทููุจ.

            ๐ฏ **ุงูุชูุตูุฉ ุงูููุงุฆูุฉ:**
            - (ุงุฎุชุฑ ูุงุญุฏุฉ: ูุคูู ููููุงุจูุฉ ุงูููุงุฆูุฉ / ูุคูู ูุน ุชุญูุธุงุช / ุจุญุงุฌุฉ ููุฑุงุฌุนุฉ ุฅุถุงููุฉ / ุบูุฑ ููุงุณุจ ููููุตุจ) ูุน ุดุฑุญ ููุฌุฒ.

            ๐ **ูุจุฑุฑุงุช ุงูุชูุตูุฉ:**
            - ุงูุฃุณุจุงุจ ุงูุชูุตูููุฉ ูููุฑุงุฑุ ุงููุนุงููุฑ ุงููุณุชุฎุฏูุฉุ ุงูููุงุฑูุฉ ูุน ูุชุทูุจุงุช ุงููุธููุฉ.

            ๐ **ุงูุฎุทูุงุช ุงูุชุงููุฉ:**
            - ุงูุชูุตูุงุช ูููุฑุญูุฉ ุงููุงุฏูุฉุ ุงููุชุทูุจุงุช ุงูุฅุถุงููุฉุ ุงูุฌุฏูู ุงูุฒููู ุงูููุชุฑุญ.

            ุงูุชุจ ุงูุชูุฑูุฑ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุดูู ูููู ูููุตู ูููุถูุนู.`
        };

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        async function extractTextFromPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let fullText = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n';
                }
                return fullText;
            } catch (error) {
                console.error('Error extracting PDF text:', error);
                throw new Error('ูุดู ูู ูุฑุงุกุฉ ููู PDF');
            }
        }

        async function extractTextFromWord(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.extractRawText({ arrayBuffer });
                return result.value;
            } catch (error) {
                console.error('Error extracting Word text:', error);
                throw new Error('ูุดู ูู ูุฑุงุกุฉ ููู Word');
            }
        }

        function validateFile(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!allowedTypes.includes(file.type)) throw new Error('ููุน ุงูููู ุบูุฑ ูุฏุนูู. ูุฑุฌู ุงุฎุชูุงุฑ ููู PDF ุฃู Word');
            if (file.size > maxSize) throw new Error('ุญุฌู ุงูููู ูุจูุฑ ุฌุฏุงู. ุงูุญุฏ ุงูุฃูุตู 10 ููุฌุงุจุงูุช');
            return true;
        }

        function showFileInfo(file) {
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = (file.size / 1024 / 1024).toFixed(2) + ' ููุฌุงุจุงูุช';
            document.getElementById('fileType').textContent = file.type.includes('pdf') ? 'PDF' : 'Word Document';
            document.getElementById('fileInfo').style.display = 'block';
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.innerHTML = `<i class="fas fa-exclamation-circle me-2"></i> ${message}`;
            errorEl.style.display = 'block';
            // setTimeout(() => errorEl.style.display = 'none', 7000); // Longer display for errors
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.innerHTML = `<i class="fas fa-check-circle me-2"></i> ${message}`;
            successEl.style.display = 'block';
            setTimeout(() => successEl.style.display = 'none', 4000);
        }
        
        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }


        function animateProgress(duration = 3000) {
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            let progress = 0;
            const intervalTime = 50; // Faster updates for smoother animation
            const steps = duration / intervalTime;
            const increment = 100 / steps;

            let currentStep = 0;
            const interval = setInterval(() => {
                currentStep++;
                progress = Math.min(100, currentStep * increment);
                progressFill.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                     setTimeout(() => {
                        // Keep progress bar at 100% until results are shown or error
                        // progressBar.style.display = 'none'; 
                    }, 500);
                }
            }, intervalTime);
             // Fallback to hide progress bar after a max duration if something goes wrong
            setTimeout(() => {
                clearInterval(interval);
                if (progressBar.style.display === 'block' && progress < 100) {
                     progressFill.style.width = '100%'; // Complete it
                     setTimeout(() => { progressBar.style.display = 'none'; }, 500);
                }
            }, duration + 1000);
        }

        async function callGeminiAPI(prompt, systemPrompt, retries = 2) { // Reduced retries for faster user feedback
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `${systemPrompt}\n\nุงููุฏุฎู: ${prompt}` }] }],
                            generationConfig: { temperature: 0.6, topK: 30, topP: 0.9, maxOutputTokens: 3000 } // Adjusted for potentially longer outputs
                        })
                    });
                    if (!response.ok) throw new Error(`ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูู API: ${response.status}`);
                    const data = await response.json();
                    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) throw new Error('ุตูุบุฉ ุงูุฑุฏ ูู ุงูู API ุบูุฑ ุตุงูุญุฉ');
                    return data.candidates[0].content.parts[0].text;
                } catch (error) {
                    console.error(`API call attempt ${i + 1} failed:`, error);
                    if (i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, 800 * (i + 1))); // Shorter retry delay
                }
            }
        }

        document.getElementById('resumeFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                hideMessages();
                try {
                    validateFile(file);
                    showFileInfo(file);
                    document.getElementById('analyzeResumeBtn').disabled = false;
                    document.querySelector('#uploadArea p').textContent = `ุชู ุงุฎุชูุงุฑ: ${file.name}`;
                    showSuccess('ุชู ุงุฎุชูุงุฑ ุงูููู ุจูุฌุงุญ. ููููู ุงูุขู ุงูุถุบุท ุนูู ุฒุฑ ุงูุชุญููู.');
                    document.getElementById('analysisResultCard').style.display = 'none'; // Hide previous results
                    document.getElementById('resumeOutput').textContent = '';
                } catch (error) {
                    showError(error.message);
                    document.getElementById('analyzeResumeBtn').disabled = true;
                }
            }
        });

        const uploadArea = document.getElementById('uploadArea');
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => uploadArea.addEventListener(eventName, preventDefaults, false));
        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
        ['dragenter', 'dragover'].forEach(eventName => uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false));
        ['dragleave', 'drop'].forEach(eventName => uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false));
        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                const file = files[0];
                 hideMessages();
                try {
                    validateFile(file);
                    document.getElementById('resumeFile').files = files; // Assign to file input
                    showFileInfo(file);
                    document.getElementById('analyzeResumeBtn').disabled = false;
                    document.querySelector('#uploadArea p').textContent = `ุชู ุงุฎุชูุงุฑ: ${file.name}`;
                    showSuccess('ุชู ุณุญุจ ูุฅููุงุช ุงูููู ุจูุฌุงุญ. ููููู ุงูุขู ุงูุถุบุท ุนูู ุฒุฑ ุงูุชุญููู.');
                    document.getElementById('analysisResultCard').style.display = 'none'; // Hide previous results
                    document.getElementById('resumeOutput').textContent = '';
                } catch (error) {
                    showError(error.message);
                    document.getElementById('analyzeResumeBtn').disabled = true;
                }
            }
        }
        
        // Helper to extract specific info from analysis text based on prompts
        function extractInfoFromAnalysis(text, field) {
            const regexes = {
                name: /ุงูุงุณู ุงููุงูู:\s*(.*)/,
                infoCount: /ุนุฏุฏ ุงูููุงุท ุงูุฑุฆูุณูุฉ ุงููุณุชุฎุฑุฌุฉ:\s*(\d+)/,
                classification: /ุงูุชูุตูุงุช ุงูุฃูููุฉ:\s*(.*)/
            };
            const match = text.match(regexes[field]);
            return match && match[1] ? match[1].trim() : '-';
        }


        async function analyzeResume() {
            const fileInput = document.getElementById('resumeFile');
            const file = fileInput.files[0];
            if (!file) { showError('ูุฑุฌู ุงุฎุชูุงุฑ ููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุฃููุงู'); return; }

            hideMessages();
            document.getElementById('resumeLoading').classList.add('show');
            document.getElementById('analysisResultCard').style.display = 'none';
            document.getElementById('resumeOutput').textContent = '';
            document.getElementById('progressBar').style.display = 'block'; // Show progress bar
            document.getElementById('progressFill').style.width = '0%'; // Reset progress fill
            animateProgress(5000); // Increased duration for analysis

            try {
                let extractedText = '';
                if (file.type === 'application/pdf') extractedText = await extractTextFromPDF(file);
                else if (file.type.includes('word') || file.type.includes('document')) extractedText = await extractTextFromWord(file);
                if (!extractedText.trim()) throw new Error('ูู ูุชู ุงูุนุซูุฑ ุนูู ูุต ูู ุงูููู');

                const analysis = await callGeminiAPI(extractedText, SYSTEM_PROMPTS.resumeAnalysis);
                
                document.getElementById('resumeOutput').innerHTML = analysis.replace(/\n/g, '<br>'); // Use innerHTML for line breaks
                
                // Populate new result display
                document.getElementById('resultFileNameDisplay').textContent = file.name;
                document.getElementById('resultInfoCountDisplay').textContent = extractInfoFromAnalysis(analysis, 'infoCount') || 'ุนุฏุฉ';
                document.getElementById('resultClassificationDisplay').textContent = extractInfoFromAnalysis(analysis, 'classification') || 'ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุชูุงุตูู';
                document.getElementById('analysisResultCard').style.display = 'block';


                currentCandidate = {
                    name: extractInfoFromAnalysis(analysis, 'name') || 'ุบูุฑ ูุญุฏุฏ', // More robust extraction
                    age: extractDataPoint(analysis, /ุงูุนูุฑ \(ุฅุฐุง ูุชููุฑ\):\s*([^\n]*)/) || 'ุบูุฑ ูุญุฏุฏ',
                    qualification: extractDataPoint(analysis, /ุงูุฏุฑุฌุงุช ุงูุนูููุฉ ูุน ุงูุชุฎุตุต:\s*([^\n]*)/) || 'ุบูุฑ ูุญุฏุฏ',
                    experience: extractDataPoint(analysis, /ุฅุฌูุงูู ุณููุงุช ุงูุฎุจุฑุฉ:\s*([^\n]*)/) || 'ุบูุฑ ูุญุฏุฏ',
                    location: extractDataPoint(analysis, /ููุงู ุงูุฅูุงูุฉ:\s*([^\n]*)/) || 'ุบูุฑ ูุญุฏุฏ',
                    fullAnalysis: analysis,
                    originalText: extractedText
                };
                showCandidateCard();
                showSuccess('ุชู ุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุจูุฌุงุญ ูุนุฑุถ ุงููุชุงุฆุฌ.');

            } catch (error) {
                document.getElementById('resumeOutput').textContent = 'ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ: ' + error.message;
                showError('ูุดู ูู ุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ: ' + error.message);
            } finally {
                 document.getElementById('resumeLoading').classList.remove('show');
                 document.getElementById('progressBar').style.display = 'none'; // Hide progress bar
            }
        }
        
        function extractDataPoint(text, regex) {
            const match = text.match(regex);
            return match && match[1] && match[1].trim() !== '[ุงุณุชุฎุฑุฌู ููุง]' ? match[1].trim() : null;
        }


        function showCandidateCard() {
            if (currentCandidate) {
                document.getElementById('candidateName').textContent = currentCandidate.name;
                document.getElementById('candidateAge').textContent = currentCandidate.age;
                document.getElementById('candidateQualification').textContent = currentCandidate.qualification;
                document.getElementById('candidateExperience').textContent = currentCandidate.experience;
                document.getElementById('candidateLocation').textContent = currentCandidate.location;
                document.getElementById('candidateCard').style.display = 'block';
                document.getElementById('candidateCard').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        async function evaluateCandidate() {
            if (!currentCandidate) { showError('ูุฑุฌู ุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุฃููุงู'); return; }
            hideMessages();
            document.getElementById('evaluationLoading').classList.add('show');
            document.getElementById('evaluationResult').innerHTML = '';
            
            try {
                const candidateData = `ุงูุงุณู: ${currentCandidate.name}\nุงูุนูุฑ: ${currentCandidate.age}\nุงููุคูู: ${currentCandidate.qualification}\nุงูุฎุจุฑุฉ: ${currentCandidate.experience}\nุงููููุน: ${currentCandidate.location}\n\nุงูุชุญููู ุงููุงูู ููุณูุฑุฉ:\n${currentCandidate.fullAnalysis}`;
                const evaluation = await callGeminiAPI(candidateData, SYSTEM_PROMPTS.candidateEvaluation);
                const scoreMatch = evaluation.match(/ูุณุจุฉ ุงูุชูุงูู ุงูุฅุฌูุงููุฉ \(ูู 100%\):\s*(\d+)%/);
                const score = scoreMatch ? parseInt(scoreMatch[1]) : generateCompatibilityScore(evaluation); // Fallback if not in text
                const scoreClass = score >= 85 ? 'score-high' : score >= 70 ? 'score-medium' : 'score-low';
                const scoreIcon = score >= 85 ? '๐ข' : score >= 70 ? '๐ก' : '๐ด';
                
                document.getElementById('evaluationResult').innerHTML = `
                    <div class="compatibility-score ${scoreClass} mb-3">
                        ${scoreIcon} ูุณุจุฉ ุงูุชูุงูู: ${score}%
                    </div>
                    <div class="output-box">${evaluation.replace(/\n/g, '<br>')}</div>`;
                currentCandidate.evaluation = evaluation;
                currentCandidate.compatibilityScore = score;
                showSuccess('ุชู ุชูููู ุงููุฑุดุญ ุจูุฌุงุญ.');
            } catch (error) {
                document.getElementById('evaluationResult').innerHTML = `<div class="alert alert-danger-custom">ุญุฏุซ ุฎุทุฃ: ${error.message}</div>`;
                showError('ูุดู ูู ุชูููู ุงููุฑุดุญ.');
            } finally {
                document.getElementById('evaluationLoading').classList.remove('show');
            }
        }

        function generateCompatibilityScore(evaluationText) { // Fallback if not extracted
            let score = 70; 
            if (evaluationText.includes('ููุชุงุฒ') || evaluationText.includes('ูุคูู ุฌุฏุง')) score += 20;
            if (evaluationText.includes('ุฌูุฏ')) score += 10;
            if (evaluationText.includes('ุถุนูู') || evaluationText.includes('ุบูุฑ ููุงุณุจ')) score -= 15;
            return Math.min(Math.max(Math.round(score), 45), 98);
        }

        async function generateQuestions() {
            const jobDescription = document.getElementById('jobDescription').value;
            if (!jobDescription.trim()) { showError('ูุฑุฌู ุฅุฏุฎุงู ูุตู ุงููุธููุฉ ุฃููุงู'); return; }
            hideMessages();
            document.getElementById('questionsLoading').classList.add('show');
            document.getElementById('questionsList').innerHTML = '';

            try {
                const questionsText = await callGeminiAPI(jobDescription, SYSTEM_PROMPTS.questionGeneration);
                const questionArray = questionsText.split('\n').map(q => q.replace(/^\d+[\.\-\)]\s*/, '').trim()).filter(q => q && q.length > 10 && q.includes('ุ'));
                
                if (questionArray.length === 0) {
                    document.getElementById('questionsList').innerHTML = `<div class="list-group-item text-warning"><i class="fas fa-exclamation-triangle me-2"></i> ูู ูุชู ุชูููุฏ ุฃุณุฆูุฉ ููุงุณุจุฉ. ูุฑุฌู ุชุญุณูู ูุตู ุงููุธููุฉ.</div>`;
                } else {
                    let questionsHTML = `<h5 class="mb-3 text-primary"><i class="fas fa-list-ul me-2"></i> ุงูุฃุณุฆูุฉ ุงููููุฏุฉ (${questionArray.length}):</h5>`;
                    questionArray.forEach((question, index) => {
                        questionsHTML += `<div class="list-group-item"><strong>ุงูุณุคุงู ${index + 1}:</strong> ${question}</div>`;
                    });
                    document.getElementById('questionsList').innerHTML = questionsHTML;
                    showSuccess('ุชู ุชูููุฏ ุงูุฃุณุฆูุฉ ุจูุฌุงุญ.');
                }
            } catch (error) {
                document.getElementById('questionsList').innerHTML = `<div class="list-group-item text-danger"><i class="fas fa-times-circle me-2"></i> ุญุฏุซ ุฎุทุฃ: ${error.message}</div>`;
                showError('ูุดู ูู ุชูููุฏ ุงูุฃุณุฆูุฉ.');
            } finally {
                document.getElementById('questionsLoading').classList.remove('show');
            }
        }

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'ar-SA';
                recognition.continuous = false; // Set to false to process after each pause
                recognition.interimResults = false; // Only final results

                recognition.onstart = () => {
                    document.getElementById('voiceStatus').innerHTML = '<i class="fas fa-microphone me-1"></i> ุฌุงุฑู ุงูุงุณุชูุงุน...';
                    document.getElementById('voiceStatus').className = 'voice-status status-listening me-2 mb-2';
                    document.getElementById('audioWave').classList.add('show');
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript.trim();
                    if (transcript) handleVoiceInput(transcript);
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    showError('ุญุฏุซ ุฎุทุฃ ูู ุงูุชุนุฑู ุนูู ุงูุตูุช: ' + event.error);
                    if(isInterviewActive) stopVoiceInterview(); // Stop if error occurs
                };

                recognition.onend = () => {
                    document.getElementById('voiceStatus').innerHTML = '<i class="fas fa-microphone-slash me-1"></i> ูุชููู';
                    document.getElementById('voiceStatus').className = 'voice-status status-stopped me-2 mb-2';
                    document.getElementById('audioWave').classList.remove('show');
                    // If interview is still active and not all questions asked, can prompt to restart listening or auto-restart
                    // For now, it stops, and user might need to interact or AI asks next question which might re-trigger listening.
                };
            } else {
                showError('ุงููุชุตูุญ ูุง ูุฏุนู ุงูุชุนุฑู ุนูู ุงูุตูุช.');
            }
        }
        
        function startVoiceInterview() {
            if (!recognition) initSpeechRecognition();
            if (recognition) {
                isInterviewActive = true;
                currentQuestionIndex = 0;
                document.getElementById('startInterviewBtn').disabled = true;
                document.getElementById('stopInterviewBtn').disabled = false;
                document.getElementById('voiceChat').innerHTML = `<div class="ai-message"><i class="fas fa-robot me-1"></i> ูุฑุญุจุงู ุจู ูู ุงูููุงุจูุฉ ุงููุจุฏุฆูุฉ ุงูุฐููุฉ. ุณุฃุทุฑุญ ุนููู ${interviewQuestions.length} ุฃุณุฆูุฉ. ุงุณุชุนุฏ ููุณุคุงู ุงูุฃูู...</div>`;
                setTimeout(() => askNextQuestionAndListen(), 2000);
                showSuccess('ุชู ุจุฏุก ุงูููุงุจูุฉ ุงูุตูุชูุฉ.');
            } else {
                 showError('ูุง ูููู ุจุฏุก ุงูููุงุจูุฉุ ุฎุงุตูุฉ ุงูุชุนุฑู ุนูู ุงูุตูุช ุบูุฑ ูุชุงุญุฉ.');
            }
        }

        function stopVoiceInterview() {
            isInterviewActive = false;
            if (recognition) recognition.stop();
            document.getElementById('startInterviewBtn').disabled = false;
            document.getElementById('stopInterviewBtn').disabled = true;
            addVoiceMessage('ุดูุฑุงู ูู ุนูู ุฅุฌุฑุงุก ุงูููุงุจูุฉ. ุณูุชู ูุฑุงุฌุนุฉ ุฅุฌุงุจุงุชู.', 'ai');
            showSuccess('ุชู ุฅููุงุก ุงูููุงุจูุฉ ุงูุตูุชูุฉ.');
        }

        function askNextQuestionAndListen() {
            if (!isInterviewActive) return;

            if (currentQuestionIndex < interviewQuestions.length) {
                const question = `ุงูุณุคุงู ${currentQuestionIndex + 1}/${interviewQuestions.length}: ${interviewQuestions[currentQuestionIndex]}`;
                addVoiceMessage(question, 'ai');
                currentQuestionIndex++;
                // Start listening after asking the question
                if (recognition && isInterviewActive) {
                     setTimeout(() => recognition.start(), 500); // Short delay before listening
                }
            } else {
                addVoiceMessage('ุชู ุงูุงูุชูุงุก ูู ุฌููุน ุงูุฃุณุฆูุฉ. ุดูุฑุงู ุฌุฒููุงู ูู ุนูู ููุชู.', 'ai');
                stopVoiceInterview();
            }
        }
        
        async function handleVoiceInput(transcript) {
            addVoiceMessage(transcript, 'user');
            if (!isInterviewActive) return;

            // Show AI thinking
            const thinkingMsg = addVoiceMessage('<i class="fas fa-spinner fa-spin"></i> ุฃููุฑ ูู ุฑุฏู...', 'ai', true);

            try {
                const promptText = `ุณุคุงู ุงูููุงุจูุฉ: "${interviewQuestions[currentQuestionIndex -1]}"\nุฅุฌุงุจุฉ ุงููุชูุฏู: "${transcript}"\n\nูู ุจุชูููู ุงูุฅุฌุงุจุฉ ูุชูุฏูู ุชุนููู ูุฎุชุตุฑ ููุดุฌุน (ุฌููุฉ ุฃู ุงุซูุชูู ููุท).`;
                const response = await callGeminiAPI(promptText, SYSTEM_PROMPTS.voiceInterview);
                thinkingMsg.innerHTML = `<i class="fas fa-robot me-1"></i> ${response}`; // Update thinking message with actual response
                
                setTimeout(() => askNextQuestionAndListen(), 2500); // Ask next question after AI response
            } catch (error) {
                thinkingMsg.innerHTML = `<i class="fas fa-robot me-1"></i> ุดูุฑุงู ูุฅุฌุงุจุชู. ุฏุนูุง ููุชูู ููุณุคุงู ุงูุชุงูู.`;
                showError('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุนุงูุฌุฉ ุฑุฏู ุงูุตูุชู.');
                setTimeout(() => askNextQuestionAndListen(), 2000);
            }
        }


        function addVoiceMessage(message, sender, isThinking = false) {
            const chatContainer = document.getElementById('voiceChat');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            messageDiv.innerHTML = sender === 'ai' ? `<i class="fas fa-robot me-1"></i> ${message}` : `<i class="fas fa-user me-1"></i> ${message}`;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            if (isThinking) return messageDiv; // Return the element if it's a temporary thinking message
        }


        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            addChatMessage(message, 'user');
            input.value = '';
            const typingDiv = addChatMessage('<i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุงููุชุงุจุฉ...', 'ai', true);
            try {
                const response = await callGeminiAPI(message, SYSTEM_PROMPTS.chatAssistant);
                typingDiv.innerHTML = `<i class="fas fa-robot me-1"></i> ${response.replace(/\n/g, '<br>')}`;
            } catch (error) {
                typingDiv.innerHTML = '<i class="fas fa-robot me-1"></i> ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.';
                showError('ูุดู ูู ุงูุญุตูู ุนูู ุฑุฏ ูู ุงููุณุงุนุฏ ุงูุฐูู.');
            }
        }

        function addChatMessage(message, sender, isTyping = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            messageDiv.innerHTML = sender === 'ai' ? `<i class="fas fa-robot me-1"></i> ${message}` : `<i class="fas fa-user me-1"></i> ${message}`;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            if(isTyping) return messageDiv;
        }

        async function generateRecommendation() {
            if (!currentCandidate) { showError('ูุฑุฌู ุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุฃููุงู'); return; }
            hideMessages();
            document.getElementById('recommendationLoading').classList.add('show');
            document.getElementById('recommendationOutput').textContent = '';
            try {
                const candidateData = `ูุนูููุงุช ุงููุฑุดุญ:\nุงูุงุณู: ${currentCandidate.name}\nุงูุนูุฑ: ${currentCandidate.age}\nุงููุคูู: ${currentCandidate.qualification}\nุงูุฎุจุฑุฉ: ${currentCandidate.experience}\n\nุชุญููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ:\n${currentCandidate.fullAnalysis}\n\n${currentCandidate.evaluation ? `ุชูููู ุงููุฑุดุญ:\n${currentCandidate.evaluation}` : ''}\n${currentCandidate.compatibilityScore ? `ูุณุจุฉ ุงูุชูุงูู: ${currentCandidate.compatibilityScore}%` : ''}`;
                const recommendation = await callGeminiAPI(candidateData, SYSTEM_PROMPTS.finalRecommendation);
                document.getElementById('recommendationOutput').innerHTML = recommendation.replace(/\n/g, '<br>');
                showSuccess('ุชู ุฅูุดุงุก ุงูุชูุตูุฉ ุงูููุงุฆูุฉ ุจูุฌุงุญ.');
            } catch (error) {
                document.getElementById('recommendationOutput').textContent = 'ุญุฏุซ ุฎุทุฃ: ' + error.message;
                showError('ูุดู ูู ุชูููุฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ.');
            } finally {
                document.getElementById('recommendationLoading').classList.remove('show');
            }
        }

        document.getElementById('chatInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') sendChatMessage(); });

        window.addEventListener('load', () => {
            initSpeechRecognition();
            // Initial animations or setup can go here
            document.querySelectorAll('.section-card, .header, .sidebar').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
            });

            let delay = 0;
            document.querySelectorAll('.header, .sidebar, .section-card').forEach(el => {
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, delay);
                delay += 100; // Stagger animation
            });
        });
    </script>
</body>
</html>